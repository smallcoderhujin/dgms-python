{% extends 'base.html' %}

{% block content %}
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <h3 class="page-title"> 空气质量 <small></small> </h3>
                <ul class="breadcrumb ">
                    <li> <i class="icon-home"></i> <a href="/">Home</a> <span class="icon-angle-right"></span> </li>
                    <li class="pull-right"> <a href="#">配置</a> </li>
                </ul>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <div class="widget">
                    <div class="widget-title">
                        <h4><i class="icon-reorder"></i>空气质量数据(最后十条)</h4>
                        <span class="tools"> <a href="#exportdata" class="btn btn-small" data-toggle="modal" rel='exportdata' title="导出数据"><i class="icon-share"></i>导出数据</a> <a href="javascript:;" class="icon-refresh"></a></span>
                        <div id="exportdata" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                <h3 id="myModalLabel">导出数据</h3>
                            </div>
                            <div class="nav-tabs"></div>
                            <form class="form-horizontal">
                                <div class="modal-body">
                                   <div class="time">
                                        <div class="pre-append date input-append datepicker"  data-date="new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);" data-date-format="yyyy-mm-dd">
                                            <label>开始时间</label>
                                            <input class="span8" id="startDate" size="16" type="text">
                                            <span class="add-on"><i class="icon-th"></i></span>
                                        </div>
                                   </div>
                                   <div class="time">
                                        <div class="input-append date datepicker" data-date="new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);" data-date-format="yyyy-mm-dd"><label>结束时间</label>
                                            <input class="span8" id="endDate" size="16" type="text">
                                            <span class="add-on"><i class="icon-th"></i></span>
                                        </div>
                                   </div>
                                </div>
                                <div class="modal-footer">
                                    <div class="span12"><a href="#" id="aExportData" class="btn btn-block btn-primary btn-large" onclick="ExportData()">生成并导出数据</a></div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="widget-body">
                        <table class="table table-striped table-bordered dataTable" id="sample_2" aria-describedby="sample_2_info">
                            <thead>
                                <th class="sorting" tabindex="0"  style="width: 163px;" >省份地区</th>
                                <th class="sorting" tabindex="0"  style="width: 303px;" >节点名称</th>
                                <th class="sorting" tabindex="0"  style="width: 303px;" >节点经度</th>
                                <th class="sorting" tabindex="0"  style="width: 181px;" >节点纬度</th>
                                <th class="sorting" tabindex="0"  style="width: 181px;" >节点纬度</th>
                                <th class="sorting" tabindex="0"  style="width: 181px;" >SO<sub>2</sub></th>
                                <th class="sorting" tabindex="0"  style="width: 181px;" >NO<sub>2</sub></th>
                                <th class="sorting" tabindex="0"  style="width: 181px;" >CO</th>
                                <th class="sorting" tabindex="0"  style="width: 181px;" >O<sub>3</sub></th>
                                <th class="sorting" tabindex="0"  style="width: 181px;" >PM10</th>
                                <th class="sorting" tabindex="0"  style="width: 181px;" >PM2.5</th>  '
                                <th class="sorting" tabindex="0"  style="width: 181px;" >时间</th>
                            </thead>
                            <tbody role="alert" aria-live="polite" aria-relevant="all">
                            {% for d in AirMonitorList %}
                                <tr class="gradeX odd">
                                    <td class="">{{d.M_ProvinceName}}</td>
                                    <td class="">{{ d.M_RegionName }}</td>
                                    <td class="">{{ d.M_NodeName }}</td>
                                    <td class="">{{ d.M_Longitude }}</td>
                                    <td class="">{{ d.M_Latitude }}</td>
                                    <td class="">{{ d.M_CO }}</td>
                                    <td class="">{{ d.M_NO2 }}</td>
                                    <td class="">{{ d.M_O3 }}</td>
                                    <td class="">{{ d.M_PM10 }}</td>
                                    <td class="">{{ d.M_PM25 }}</td>
                                    <td class="">{{ d.M_SO2 }}</td>
                                    <td class="">{{ d.M_RecordTime }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        <div class="row-fluid">
                            <div class="span8">
                                <div class="dataTables_paginate paging_bootstrap pagination">
                                    <ul>
                                        <li class="prev disabled"><a href="#"><i class="icon-chevron-left"></i>上一页</a></li>
                                        <li class="active"><a href="#">1</a></li>
                                        <li><a href="#">2</a></li>
                                        <li><a href="#">3</a></li>
                                        <li class="next"><a href="#">下一页<i class="icon-chevron-right"></i> </a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
    function ExportData(){
        var start=$('#startDate').val();
        if(start=='')
        {
            alert('请选择开始时间');
            return;
        }
        var end=$('#endDate').val();
        if(end==''){
            alert('请选择结束时间');
            return;
        }
        $('#aExportData').html('耐心等待，正在努力导出...');
        $('#aExportData').addClass('disabled');
        $.ajax({
            url:'/air_quality/export/',
            type:'GET',
            data:{'start':start,'end':end},
            async:true,
            success:function(data){
                $('#aExportData').html('生成并导出数据');
                $('#aExportData').removeClass('disabled');
                if(data!='fail'){
                    top.location.href=data;
                }else{
                    alert('导出失败')
                }
            }
        });
    }
    </script>
{% endblock %}